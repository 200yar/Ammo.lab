'use strict';var THREE,list,extensions,numDiv,data,TextDecoder,ammo,intro,UIL,esprima,CodeMirror,Br,Cr,Jr,Hr,Sr,demos;var ARRAY8;ARRAY8||(ARRAY8="undefined"!==typeof Uint8Array?Uint8Array:Array);function Perlin(a){this.F2=0.5*(Math.sqrt(3)-1);this.G2=(3-Math.sqrt(3))/6;a||(a=Math.random);this.p=new ARRAY8(256);this.perm=new ARRAY8(512);this.permMod12=new ARRAY8(512);for(var c=0;256>c;c++)this.p[c]=256*a();for(c=0;512>c;c++)this.perm[c]=this.p[c&255],this.permMod12[c]=this.perm[c]%12}
Perlin.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),noise:function(a,c){var e=this.permMod12,f=this.perm,d=this.grad3,h=0,g=0,k=0,l=(a+c)*this.F2,m=Math.floor(a+l),y=Math.floor(c+l),l=(m+y)*this.G2,u=a-(m-l),F=c-(y-l),w,b;u>F?(w=1,b=0):(w=0,b=1);var z=u-w+this.G2,x=F-b+this.G2,l=u-1+2*this.G2,p=F-1+2*this.G2,m=m&255,y=y&255,n=0.5-u*u-F*F;0<=n&&(h=3*e[m+f[y]],n*=n,h=n*n*(d[h]*u+d[h+1]*F));u=0.5-z*z-x*x;0<=u&&(g=3*e[m+w+f[y+
b]],u*=u,g=u*u*(d[g]*z+d[g+1]*x));z=0.5-l*l-p*p;0<=z&&(e=3*e[m+1+f[y+1]],z*=z,k=z*z*(d[e]*l+d[e+1]*p));return 70*(h+g+k)}};THREE.OrbitControls=function(a,c){function e(){return Math.pow(0.95,b.zoomSpeed)}function f(a){b.object instanceof THREE.PerspectiveCamera?D/=a:b.object instanceof THREE.OrthographicCamera?(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom*a)),b.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function d(a){b.object instanceof THREE.PerspectiveCamera?D*=a:b.object instanceof THREE.OrthographicCamera?
(b.object.zoom=Math.max(b.minZoom,Math.min(b.maxZoom,b.object.zoom/a)),b.object.updateProjectionMatrix(),A=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),b.enableZoom=!1)}function h(a){if(!1!==b.enabled){a.preventDefault();if(a.button===b.mouseButtons.ORBIT){if(!1===b.enableRotate)return;H.set(a.clientX,a.clientY);r=n.ROTATE}else if(a.button===b.mouseButtons.ZOOM){if(!1===b.enableZoom)return;L.set(a.clientX,a.clientY);r=n.DOLLY}else if(a.button===
b.mouseButtons.PAN){if(!1===b.enablePan)return;P.set(a.clientX,a.clientY);r=n.PAN}r!==n.NONE&&(document.addEventListener("mousemove",g,!1),document.addEventListener("mouseup",k,!1),b.dispatchEvent(x))}}function g(a){!1!==b.enabled&&(a.preventDefault(),r===n.ROTATE?!1!==b.enableRotate&&(B.set(a.clientX,a.clientY),M.subVectors(B,H),a=b.domElement===document?b.domElement.body:b.domElement,v.theta-=2*Math.PI*M.x/a.clientWidth*b.rotateSpeed,v.phi-=2*Math.PI*M.y/a.clientHeight*b.rotateSpeed,H.copy(B),b.update()):
r===n.DOLLY?!1!==b.enableZoom&&(N.set(a.clientX,a.clientY),G.subVectors(N,L),0<G.y?f(e()):0>G.y&&d(e()),L.copy(N),b.update()):r===n.PAN&&!1!==b.enablePan&&(J.set(a.clientX,a.clientY),O.subVectors(J,P),K(O.x,O.y),P.copy(J),b.update()))}function k(a){!1!==b.enabled&&(document.removeEventListener("mousemove",g,!1),document.removeEventListener("mouseup",k,!1),b.dispatchEvent(p),r=n.NONE)}function l(a){!1===b.enabled||!1===b.enableZoom||r!==n.NONE&&r!==n.ROTATE||(a.preventDefault(),a.stopPropagation(),
0>a.deltaY?d(e()):0<a.deltaY&&f(e()),b.update(),b.dispatchEvent(x),b.dispatchEvent(p))}function m(a){if(!1!==b.enabled&&!1!==b.enableKeys&&!1!==b.enablePan)switch(a.keyCode){case b.keys.UP:K(0,b.keyPanSpeed);b.update();break;case b.keys.BOTTOM:K(0,-b.keyPanSpeed);b.update();break;case b.keys.LEFT:K(b.keyPanSpeed,0);b.update();break;case b.keys.RIGHT:K(-b.keyPanSpeed,0),b.update()}}function y(a){if(!1!==b.enabled){switch(a.touches.length){case 1:if(!1===b.enableRotate)return;H.set(a.touches[0].pageX,
a.touches[0].pageY);r=n.TOUCH_ROTATE;break;case 2:if(!1===b.enableZoom)return;var e=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;e=Math.sqrt(e*e+a*a);L.set(0,e);r=n.TOUCH_DOLLY;break;case 3:if(!1===b.enablePan)return;P.set(a.touches[0].pageX,a.touches[0].pageY);r=n.TOUCH_PAN;break;default:r=n.NONE}r!==n.NONE&&b.dispatchEvent(x)}}function u(a){if(!1!==b.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:if(!1===b.enableRotate)break;if(r!==
n.TOUCH_ROTATE)break;B.set(a.touches[0].pageX,a.touches[0].pageY);M.subVectors(B,H);var c=b.domElement===document?b.domElement.body:b.domElement;v.theta-=2*Math.PI*M.x/c.clientWidth*b.rotateSpeed;v.phi-=2*Math.PI*M.y/c.clientHeight*b.rotateSpeed;H.copy(B);b.update();break;case 2:if(!1===b.enableZoom)break;if(r!==n.TOUCH_DOLLY)break;c=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;c=Math.sqrt(c*c+a*a);N.set(0,c);G.subVectors(N,L);0<G.y?d(e()):0>G.y&&f(e());L.copy(N);
b.update();break;case 3:if(!1===b.enablePan)break;if(r!==n.TOUCH_PAN)break;J.set(a.touches[0].pageX,a.touches[0].pageY);O.subVectors(J,P);K(O.x,O.y);P.copy(J);b.update();break;default:r=n.NONE}}function F(a){!1!==b.enabled&&(b.dispatchEvent(p),r=n.NONE)}function w(a){a.preventDefault()}this.object=a;this.domElement=void 0!==c?c:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=
Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=0.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=
this.object.zoom;this.getPolarAngle=function(){return s.phi};this.getAzimuthalAngle=function(){return s.theta};this.reset=function(){b.target.copy(b.target0);b.object.position.copy(b.position0);b.object.zoom=b.zoom0;b.object.updateProjectionMatrix();b.dispatchEvent(z);b.update();r=n.NONE};this.update=function(){var e=new THREE.Vector3,c=(new THREE.Quaternion).setFromUnitVectors(a.up,new THREE.Vector3(0,1,0)),d=c.clone().inverse(),f=new THREE.Vector3,k=new THREE.Quaternion;return function(){var a=
b.object.position;e.copy(a).sub(b.target);e.applyQuaternion(c);s.setFromVector3(e);b.autoRotate&&r===n.NONE&&(v.theta-=2*Math.PI/60/60*b.autoRotateSpeed);s.theta+=v.theta;s.phi+=v.phi;s.theta=Math.max(b.minAzimuthAngle,Math.min(b.maxAzimuthAngle,s.theta));s.phi=Math.max(b.minPolarAngle,Math.min(b.maxPolarAngle,s.phi));s.makeSafe();s.radius*=D;s.radius=Math.max(b.minDistance,Math.min(b.maxDistance,s.radius));b.target.add(E);e.setFromSpherical(s);e.applyQuaternion(d);a.copy(b.target).add(e);b.object.lookAt(b.target);
!0===b.enableDamping?(v.theta*=1-b.dampingFactor,v.phi*=1-b.dampingFactor):v.set(0,0,0);D=1;E.set(0,0,0);return A||f.distanceToSquared(b.object.position)>C||8*(1-k.dot(b.object.quaternion))>C?(b.dispatchEvent(z),f.copy(b.object.position),k.copy(b.object.quaternion),A=!1,!0):!1}}();this.dispose=function(){b.domElement.removeEventListener("contextmenu",w,!1);b.domElement.removeEventListener("mousedown",h,!1);b.domElement.removeEventListener("wheel",l,!1);b.domElement.removeEventListener("touchstart",
y,!1);b.domElement.removeEventListener("touchend",F,!1);b.domElement.removeEventListener("touchmove",u,!1);document.removeEventListener("mousemove",g,!1);document.removeEventListener("mouseup",k,!1);window.removeEventListener("keydown",m,!1)};var b=this,z={type:"change"},x={type:"start"},p={type:"end"},n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},r=n.NONE,C=1E-6,s=new THREE.Spherical,v=new THREE.Spherical,D=1,E=new THREE.Vector3,A=!1,H=new THREE.Vector2,B=new THREE.Vector2,
M=new THREE.Vector2,P=new THREE.Vector2,J=new THREE.Vector2,O=new THREE.Vector2,L=new THREE.Vector2,N=new THREE.Vector2,G=new THREE.Vector2,q=function(){var a=new THREE.Vector3;return function(b,e){a.setFromMatrixColumn(e,0);a.multiplyScalar(-b);E.add(a)}}(),U=function(){var a=new THREE.Vector3;return function(b,e){a.setFromMatrixColumn(e,1);a.multiplyScalar(b);E.add(a)}}(),K=function(){var a=new THREE.Vector3;return function(e,c){var d=b.domElement===document?b.domElement.body:b.domElement;if(b.object instanceof
THREE.PerspectiveCamera){a.copy(b.object.position).sub(b.target);var f=a.length(),f=f*Math.tan(b.object.fov/2*Math.PI/180);q(2*e*f/d.clientHeight,b.object.matrix);U(2*c*f/d.clientHeight,b.object.matrix)}else b.object instanceof THREE.OrthographicCamera?(q(e*(b.object.right-b.object.left)/b.object.zoom/d.clientWidth,b.object.matrix),U(c*(b.object.top-b.object.bottom)/b.object.zoom/d.clientHeight,b.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),
b.enablePan=!1)}}();b.domElement.addEventListener("contextmenu",w,!1);b.domElement.addEventListener("mousedown",h,!1);b.domElement.addEventListener("wheel",l,!1);b.domElement.addEventListener("touchstart",y,!1);b.domElement.addEventListener("touchend",F,!1);b.domElement.addEventListener("touchmove",u,!1);window.addEventListener("keydown",m,!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;
Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){console.warn("THREE.OrbitControls: .center has been renamed to .target");return this.target}},noZoom:{get:function(){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(a){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!a}},noRotate:{get:function(){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");
return!this.enableRotate},set:function(a){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!a}},noPan:{get:function(){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(a){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!a}},noKeys:{get:function(){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");
return!this.enableKeys},set:function(a){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!a}},staticMoving:{get:function(){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.enableDamping},set:function(a){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.enableDamping=!a}},dynamicDampingFactor:{get:function(){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");
return this.dampingFactor},set:function(a){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.dampingFactor=a}}});THREE.CapsuleBufferGeometry=function(a,c,e,f){THREE.BufferGeometry.call(this);this.type="CapsuleBufferGeometry";a=a||1;c=c||1;var d=e||12,h=0.5*~~d;e=f||1;var g=2*Math.PI,k=0.5*Math.PI;f=new THREE.Geometry;e=new THREE.CylinderGeometry(a,a,c,d,e,!0);var l=new THREE.SphereGeometry(a,d,h,0,g,0,k);a=new THREE.SphereGeometry(a,d,h,0,g,k,k);d=(new THREE.Matrix4).makeTranslation(0,0,0);h=(new THREE.Matrix4).makeTranslation(0,0.5*c,0);c=(new THREE.Matrix4).makeTranslation(0,0.5*-c,0);f.merge(e,d);f.merge(l,
h);f.merge(a,c);f.mergeVertices();this.fromGeometry(f)};THREE.CapsuleBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.CapsuleBufferGeometry.prototype.constructor=THREE.CapsuleBufferGeometry;THREE.ConvexGeometry=function(a){function c(e){var c=a[e].clone(),d=c.length();c.x+=2E-6*d*(Math.random()-0.5);c.y+=2E-6*d*(Math.random()-0.5);c.z+=2E-6*d*(Math.random()-0.5);for(var d=[],k=0;k<f.length;){var g=f[k],b=c,h=a[g[0]],l;l=h;var p=a[g[1]],n=a[g[2]],r=new THREE.Vector3,C=new THREE.Vector3;r.subVectors(n,p);C.subVectors(l,p);r.cross(C);r.normalize();l=r;h=l.dot(h);if(l.dot(b)>=h){for(b=0;3>b;b++){h=[g[b],g[(b+1)%3]];l=!0;for(p=0;p<d.length;p++)if(n=d[p],n[0]===h[1]&&n[1]===h[0]){d[p]=d[d.length-
1];d.pop();l=!1;break}l&&d.push(h)}f[k]=f[f.length-1];f.pop()}else k++}for(p=0;p<d.length;p++)f.push([d[p][0],d[p][1],e])}function e(a){var e=a.length();return new THREE.Vector2(a.x/e,a.y/e)}THREE.Geometry.call(this);for(var f=[[0,1,2],[0,2,1]],d=3;d<a.length;d++)c(d);for(var h=0,g=Array(a.length),d=0;d<f.length;d++)for(var k=f[d],l=0;3>l;l++)void 0===g[k[l]]&&(g[k[l]]=h++,this.vertices.push(a[k[l]])),k[l]=g[k[l]];for(d=0;d<f.length;d++)this.faces.push(new THREE.Face3(f[d][0],f[d][1],f[d][2]));for(d=
0;d<this.faces.length;d++)k=this.faces[d],this.faceVertexUvs[0].push([e(this.vertices[k.a]),e(this.vertices[k.b]),e(this.vertices[k.c])]);this.computeFaceNormals();this.computeVertexNormals()};THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ConvexGeometry.prototype.constructor=THREE.ConvexGeometry;THREE.Tubex=function(a,c,e,f,d,h){THREE.BufferGeometry.call(this);this.type="Tubex";this.tubularSegments=c||64;this.radius=e||1;this.radialSegments=f||8;this.closed=d||!1;if(a instanceof Array)this.positions=a;else{this.positions=[];c=(new THREE.Vector3).fromArray(a.start);e=(new THREE.Vector3).fromArray(a.end);f=e.clone().sub(c);a=a.numSegment-1;this.positions.push(c);for(d=1;d<a;d++)this.positions.push((new THREE.Vector3(f.x/a*d,f.y/a*d,f.z/a*d)).add(c));this.positions.push(e)}this.path=new THREE.CatmullRomCurve3(this.positions);
this.path.type=h||"catmullrom";this.path.closed=this.closed;this.frames=this.path.computeFrenetFrames(this.tubularSegments,this.closed);this.vertex=new THREE.Vector3;this.normal=new THREE.Vector3;this.uv=new THREE.Vector2;this.vertices=[];this.normals=[];this.uvs=[];this.indices=[];this.generateBufferData();this.setIndex(new (65535<this.indices.length?THREE.Uint32BufferAttribute:THREE.Uint16BufferAttribute)(this.indices,1));this.addAttribute("position",new THREE.Float32BufferAttribute(this.vertices,
3));this.addAttribute("normal",new THREE.Float32BufferAttribute(this.normals,3));this.addAttribute("uv",new THREE.Float32BufferAttribute(this.uvs,2))};THREE.Tubex.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.Tubex.prototype.constructor=THREE.Tubex;THREE.Tubex.prototype.generateBufferData=function(){for(var a=0;a<this.tubularSegments;a++)this.generateSegment(a);this.generateSegment(!1===this.closed?this.tubularSegments:0);this.generateIndicesAndUv()};
THREE.Tubex.prototype.generateSegment=function(a){var c=this.path.getPointAt(a/this.tubularSegments),e=this.frames.normals[a];a=this.frames.binormals[a];for(var f=0;f<=this.radialSegments;f++){var d=f/this.radialSegments*Math.PI*2,h=Math.sin(d),d=-Math.cos(d);this.normal.x=d*e.x+h*a.x;this.normal.y=d*e.y+h*a.y;this.normal.z=d*e.z+h*a.z;this.normal.normalize();this.normals.push(this.normal.x,this.normal.y,this.normal.z);this.vertex.x=c.x+this.radius*this.normal.x;this.vertex.y=c.y+this.radius*this.normal.y;
this.vertex.z=c.z+this.radius*this.normal.z;this.vertices.push(this.vertex.x,this.vertex.y,this.vertex.z)}};
THREE.Tubex.prototype.generateIndicesAndUv=function(){for(var a=0;a<=this.tubularSegments;a++)for(var c=0;c<=this.radialSegments;c++){if(0<c&&0<a){var e=(this.radialSegments+1)*a+(c-1),f=(this.radialSegments+1)*a+c,d=(this.radialSegments+1)*(a-1)+c;this.indices.push((this.radialSegments+1)*(a-1)+(c-1),e,d);this.indices.push(e,f,d)}this.uv.x=a/this.tubularSegments;this.uv.y=c/this.radialSegments;this.uvs.push(this.uv.x,this.uv.y)}};
THREE.Tubex.prototype.updatePath=function(a){this.frames=this.path.computeFrenetFrames(this.tubularSegments,this.closed);this.normals=this.attributes.normal.array;this.vertices=this.attributes.position.array;for(a=0;a<this.tubularSegments;a++)this.updateSegment(a);this.updateSegment(!1===this.closed?this.tubularSegments:0);this.attributes.position.needsUpdate=!0;this.attributes.normal.needsUpdate=!0};
THREE.Tubex.prototype.updateUV=function(){this.uvs=this.attributes.uv.array;for(var a,c,e=0;e<=this.tubularSegments;e++){a=2*e*(this.radialSegments+1);for(var f=0;f<=this.radialSegments;f++)c=2*f,this.uv.x=e/this.tubularSegments,this.uv.y=f/this.radialSegments,this.uvs[a+c]=this.uv.x,this.uvs[a+c+1]=this.uv.y}this.attributes.uv.needsUpdate=!0};
THREE.Tubex.prototype.updateSegment=function(a){for(var c=3*a*(this.radialSegments+1),e=this.path.getPointAt(a/this.tubularSegments),f=this.frames.normals[a],d=this.frames.binormals[a],h=0;h<=this.radialSegments;h++){var g=h/this.radialSegments*Math.PI*2;a=3*h;var k=Math.sin(g),g=-Math.cos(g);this.normal.x=g*f.x+k*d.x;this.normal.y=g*f.y+k*d.y;this.normal.z=g*f.z+k*d.z;this.normal.normalize();this.normals[c+a]=this.normal.x;this.normals[c+a+1]=this.normal.y;this.normals[c+a+2]=this.normal.z;this.vertices[c+
a]=e.x+this.radius*this.normal.x;this.vertices[c+a+1]=e.y+this.radius*this.normal.y;this.vertices[c+a+2]=e.z+this.radius*this.normal.z}};THREE.ShaderShadow={uniforms:Object.assign({},THREE.UniformsLib.lights,{diffuse:{value:new THREE.Color(15658734)},specular:{value:new THREE.Color(1118481)},emissive:{value:new THREE.Color(0)},opacity:{value:0.4}}),fragmentShader:["uniform float opacity;\nvarying vec2 vUv;",THREE.ShaderChunk.common,THREE.ShaderChunk.packing,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.shadowmask_pars_fragment,"void main() {\n   float mask = getShadowMask();\n   vec4 pp = vec4(1.0);\n   vec4 mapping = vec4( pp.rgb, pp.a * opacity );\n   vec4 shadowing = vec4( vec3(0.0), opacity * (1.0 - mask) );\n   gl_FragColor = mix( mapping, shadowing, 1.0 - mask );\n   gl_FragColor = shadowing;\n}"].join("\n"),
vertexShader:["varying vec2 vUv;",THREE.ShaderChunk.common,THREE.ShaderChunk.bsdfs,THREE.ShaderChunk.lights_pars,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvUv = uv;\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),lights:!0,transparent:!0};THREE.CarHelper=function(a){this.py=a[1];a=new Float32Array([-0.2,0,0,0.2,0,0,0,0,0,0,0.4,0,0,0,-0.2,0,0,0.2,0.5*a[0],a[1],a[2],0.5*a[0],a[1]+1,a[2],0.5*-a[0],a[1],a[2],0.5*-a[0],a[1]+1,a[2],0.5*-a[0],a[1],-a[2],0.5*-a[0],a[1]+1,-a[2],0.5*a[0],a[1],-a[2],0.5*a[0],a[1]+1,-a[2]]);var c=new Float32Array([1,1,0,1,1,0,1,1,0,0,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0,1,1,0]);this.geometry=new THREE.BufferGeometry;this.geometry.addAttribute("position",new THREE.BufferAttribute(a,3));this.geometry.addAttribute("color",
new THREE.BufferAttribute(c,3));this.positions=this.geometry.attributes.position.array;this.material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,name:"helper"});THREE.LineSegments.call(this,this.geometry,this.material)};THREE.CarHelper.prototype=Object.create(THREE.LineSegments.prototype);THREE.CarHelper.prototype.constructor=THREE.CarHelper;THREE.CarHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};
THREE.CarHelper.prototype.updateSuspension=function(a,c,e,f){this.positions[22]=this.py-a;this.positions[28]=this.py-c;this.positions[34]=this.py-e;this.positions[40]=this.py-f;this.geometry.attributes.position.needsUpdate=!0};THREE.Terrain=function(a,c){a=void 0==a?{}:a;this.div=void 0==a.div?[64,64]:a.div;this.size=void 0==a.size?[100,10,100]:a.size;this.colorBase={r:1,g:0.7,b:0};this.complexity=void 0==a.complexity?30:a.complexity;this.complexity2=void 0==a.complexity2?60:a.complexity2;this.local=new THREE.Vector3;a.local&&this.local.fromArray(a.local);this.lng=this.div[0]*this.div[1];this.hdata=new Float32Array(this.lng);this.perlin=void 0==c?new Perlin:c;this.colors=new Float32Array(3*this.lng);this.geometry=new THREE.PlaneBufferGeometry(this.size[0],
this.size[2],this.div[0]-1,this.div[1]-1);this.geometry.rotateX(0.5*-Math.PI);this.geometry.computeBoundingSphere();this.geometry.addAttribute("color",new THREE.BufferAttribute(this.colors,3));this.vertices=this.geometry.attributes.position.array;this.material=new THREE.MeshStandardMaterial({vertexColors:THREE.VertexColors,name:"terrain",metalness:1,roughness:0.3,wireframe:!1});this.update();THREE.Mesh.call(this,this.geometry,this.material);this.castShadow=!1;this.receiveShadow=!0};
THREE.Terrain.prototype=Object.create(THREE.Mesh.prototype);THREE.Terrain.prototype.constructor=THREE.Terrain;THREE.Terrain.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.Terrain.prototype.setEnvMap=function(a){this.material.envMap=a};THREE.Terrain.prototype.move=function(){this.update()};THREE.Terrain.prototype.clamp=function(a,c,e){a=a<c?c:a;return a>e?e:a};THREE.Terrain.prototype.norm=function(a,c,e){return(a-c)/(e-c)};
THREE.Terrain.prototype.linear=function(a,c,e){return(1-a)*c+a*e};THREE.Terrain.prototype.cubicSCurve=function(a){return a*a*(3-2*a)};THREE.Terrain.prototype.quinticSCurve=function(a){var c=a*a*a,e=c*a;return 6*e*a-15*e+10*c};
THREE.Terrain.prototype.update=function(){for(var a=1/this.complexity,c=1/this.complexity2,e=1/this.div[0],f=(this.div[0]-1)/this.size[0],d=(this.div[1]-1)/this.size[2],h=this.lng,g,k,l,m;h--;)g=3*h,k=h%this.div[0],l=~~(h*e),m=0.5+0.5*this.perlin.noise((k+this.local.x*f)*a,(l+this.local.z*d)*a),k=0.5+0.5*this.perlin.noise((k+100+this.local.x*f)*c,(l+100+this.local.z*d)*c),m=Math.min(m,k),m=this.linear(m,0,0.7),m=this.quinticSCurve(m),this.hdata[h]=m*this.size[1],this.vertices[g+1]=this.hdata[h],this.colors[g]=
m*this.colorBase.r,this.colors[g+1]=m*this.colorBase.g,this.colors[g+2]=m*this.colorBase.b;this.geometry.attributes.position.needsUpdate=!0;this.geometry.attributes.color.needsUpdate=!0;this.geometry.computeVertexNormals()};THREE.ViewUtils={mergeGeometryArray:function(a){for(var c=[],e=a.length;e--;)c[e]=(new THREE.Geometry).fromBufferGeometry(a[e]);for(a=new THREE.Geometry;0<c.length;)e=c.pop(),a.merge(e),e.dispose();a.mergeVertices();c=(new THREE.BufferGeometry).fromGeometry(a);a.dispose();return c},prepaGeometry:function(a,c){var e=!1,f=!1;"mesh"==c&&(f=!0);"convex"==c&&(e=!0);var d,h,g,k=(new THREE.Geometry).fromBufferGeometry(a);k.mergeVertices();var l=a.attributes.position.array.length/3,m=k.vertices.length,y=
k.faces.length;a.realVertices=new Float32Array(3*m);a.realIndices=new (65535<3*y?Uint32Array:Uint16Array)(3*y);for(d=m;d--;)g=k.vertices[d],h=3*d,a.realVertices[h]=g.x,a.realVertices[h+1]=g.y,a.realVertices[h+2]=g.z;if(e)return k.dispose(),a.realVertices;for(d=y;d--;)g=k.faces[d],h=3*d,a.realIndices[h]=g.a,a.realIndices[h+1]=g.b,a.realIndices[h+2]=g.c;k.dispose();if(f){l=[];for(d=a.realIndices.length;d--;)h=3*d,g=3*a.realIndices[d],l[h]=a.realVertices[g],l[h+1]=a.realVertices[g+1],l[h+2]=a.realVertices[g+
2];return l}f=[];k=a.attributes.position.array;for(d=m;d--;)for(h=3*d,f[d]=[],e=l;e--;)g=3*e,k[g]==a.realVertices[h]&&k[g+1]==a.realVertices[h+1]&&k[g+2]==a.realVertices[h+2]&&f[d].push(e);var k=new (65535<m?Uint32Array:Uint16Array)(m),u=new (65535<l?Uint32Array:Uint16Array)(l);for(d=g=0;d<m;d++){h=f[d].length;k[d]=g;for(e=h;e--;)u[g+e]=f[d][e];g+=h}a.numFaces=y;a.numVertices=m;a.maxi=l;a.pPoint=k;a.lPoint=u}};var user=function(){var a=new Float32Array(20),c;user={init:function(e){c=new user.Gamepad(a);document.addEventListener("keydown",user.keyDown,!1);document.addEventListener("keyup",user.keyUp,!1)},update:function(a){c.update();c.ready&&c.getValue(0)},keyDown:function(e){if(!editor.getFocus()){e=e||window.event;switch(e.which){case 65:case 81:a[0]=-1;break;case 68:a[0]=1;break;case 87:case 90:a[1]=-1;break;case 83:a[1]=1;break;case 37:a[2]=-1;break;case 39:a[2]=1;break;case 38:a[3]=-1;break;case 40:a[3]=
1;break;case 17:case 67:a[5]=1;break;case 69:a[5]=1;break;case 32:a[4]=1;break;case 16:a[7]=1;break;case 71:view.hideGrid()}c.reset()}},keyUp:function(e){if(!editor.getFocus())switch(e=e||window.event,e.which){case 65:case 81:a[0]=0>a[0]?0:a[0];break;case 68:a[0]=0<a[0]?0:a[0];break;case 87:case 90:a[1]=0>a[1]?0:a[1];break;case 83:a[1]=0<a[1]?0:a[1];break;case 37:a[2]=0>a[2]?0:a[2];break;case 39:a[2]=0<a[2]?0:a[2];break;case 38:a[3]=0>a[3]?0:a[3];break;case 40:a[3]=0<a[3]?0:a[3];break;case 17:case 67:a[5]=
0;break;case 69:a[5]=0;break;case 32:a[4]=0;break;case 16:a[7]=0}},getKey:function(){return a},Gamepad:function(a){this.values=[];this.key=a;this.ready=0}};user.Gamepad.prototype={update:function(){var a,c,d,h,g,k,l=this.fix,m=navigator.getGamepads();for(a=0;a<m.length;a++)if(k=m[a])if(d=k.axes.length,h=k.buttons.length){this.values[a]||(this.values[a]=[]);for(c=0;c<d;c++)g=l(k.axes[c],0.08),0==this.ready&&0!==g&&(this.ready=1),this.values[a][c]=g;for(c=0;c<h;c++)g=l(k.buttons[c].value),0==this.ready&&
0!==g&&(this.ready=1),this.values[a][d+c]=g}else this.values[a]&&(this.values[a]=null)},getValue:function(a){for(var c=19,d;c--;)d=this.values[a][c],0==this.ready&&0!==d&&(this.ready=1),this.key[c]=d},reset:function(){this.ready=0},fix:function(a,c){var d=Number(a.toString().substring(0,5));c&&d<c&&d>-c&&(d=0);return d}};return user}();var gui=function(){var a;return gui={init:function(){a=document.createElement("div");document.body.appendChild(a)},initJoysticks:function(){UIL.add("joystick",{target:a,pos:{left:"auto",right:"100px",top:"auto",bottom:"10px"},name:"JOY",width:100,multiplicator:1,precision:2,fontColor:"#D4B87B"})}}}();var now;(function(a){var c,e=["now","webkitNow","msNow","mozNow"];if(a.performance)for(var f=0;f<e.length;++f){var d=e[f];if(a.performance[d]){c=function(){return a.performance[d]()};break}}c||(c=Date.now);now=c})(window);var editor=function(){var a,c,e,f,d,h,g,k=function(){},l=!1,m=!1,y=[],u=[],F=null,w=0,b=0,z="",x,p=[],n,r=!1,C=!0,s=!1,v,D;editor=function(){};editor.init=function(b,A){b&&(k=b);C=A||!1;x=document.createElement("div");x.className="bigmenu";document.body.appendChild(x);this.makeBigMenu();var n=document.createElement("div");n.style.cssText="position:absolute; right:0; top:0; width:1px; height:1px; pointer-events:none;";n.innerHTML="<svg width='80' height='80' viewBox='0 0 250 250' style='fill:rgba(255,255,255,0.2); color:#2B2A2D; position: absolute; top: 0; border: 0; right: 0;'>\n<path d='M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z' id='octo' onmouseover='editor.Gover();' onmouseout='editor.Gout();' onmousedown='editor.Gdown();'></path>\n<path d='M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2' fill='currentColor' style='transform-origin: 130px 106px;' id='octo-arm'></path>\n<path d='M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z' fill='currentColor' id='octo-body'></path></svg>";
document.body.appendChild(n);v=document.getElementById("octo");D=document.getElementById("octo-arm");h=document.createElement("div");h.className="debug";document.body.appendChild(h);g=document.createElement("div");g.className="title";document.body.appendChild(g);a=document.createElement("div");a.className="editor";document.body.appendChild(a);c=document.createElement("div");c.className="codeContent";a.appendChild(c);e=CodeMirror(c,{lineNumbers:!0,matchBrackets:!0,indentWithTabs:!1,styleActiveLine:!0,
theme:"monokai",mode:"text/javascript",tabSize:4,indentUnit:4,highlightSelectionMatches:{showToken:/\w/}});f=document.createElement("div");f.className="separator";document.body.appendChild(f);d=document.createElement("div");d.className="menuCode";a.appendChild(d);a.style.display="none";f.style.display="none";e.on("change",function(){editor.onChange()});e.on("focus",function(){m=!0;view.needFocus()});e.on("blur",function(){m=!1});e.on("drop",function(){l?l=!1:e.setValue("")});e.on("dragstart",function(){l=
!0});C&&(w=~~(0.4*window.innerWidth),a.style.display="block",f.style.display="block",this.addSeparatorEvent(),this.resize());x.style.width=window.innerWidth-w+"px"};editor.addSeparatorEvent=function(){f.addEventListener("mouseover",editor.mid_over,!1);f.addEventListener("mouseout",editor.mid_out,!1);f.addEventListener("mousedown",editor.mid_down,!1)};editor.removeSeparatorEvent=function(){f.removeEventListener("mouseover",editor.mid_over,!1);f.removeEventListener("mouseout",editor.mid_out,!1);f.removeEventListener("mousedown",
editor.mid_down,!1)};editor.selectCode=function(){C?editor.hide():editor.show()};editor.hide=function(){C=!1;a.style.display="none";f.style.display="none";b=w;w=0;this.removeSeparatorEvent();editor.Bdefault(p[1]);editor.resize()};editor.show=function(){C=!0;a.style.display="block";f.style.display="block";w=b?b:~~(0.4*window.innerWidth);this.addSeparatorEvent();editor.resize()};editor.resizeMenu=function(a){x&&(x.style.width=a+"px")};editor.resize=function(b){b&&(w=b.clientX+10);view&&(view.setLeft(w),
view.resize());x.style.left=w+"px";g.style.left=w+"px";h.style.left=w+"px";f.style.left=w-10+"px";a.style.width=w-10+"px";e.refresh()};editor.tell=function(a){h.innerHTML=a};editor.makeBigMenu=function(){x.style.width=window.innerWidth-w+"px";p[0]=document.createElement("div");p[0].className="bigButton";x.appendChild(p[0]);p[0].innerHTML="DEMO";p[0].addEventListener("mousedown",editor.selectBigMenu,!1);p[0].name="demo";p[1]=document.createElement("div");p[1].className="bigButton";x.appendChild(p[1]);
p[1].innerHTML="CODE";p[1].addEventListener("mousedown",editor.selectCode,!1);p[1].name="code";n=document.createElement("div");n.className="bigContent";x.appendChild(n);for(var a=p.length;a--;)p[a].addEventListener("mouseover",editor.Bover,!1),p[a].addEventListener("mouseout",editor.Bout,!1)};editor.selectBigMenu=function(a){r?editor.hideBigMenu():editor.showBigMenu()};editor.showBigMenu=function(a){x.style.background="#242424";x.style.borderBottom="1px solid #5c5c5c";r=!0;a=demos.length;for(var b,
c=0;c<a;c++)b=demos[c],b!==z&&editor.addButtonBig(demos[c])};editor.hideBigMenu=function(a){x.style.background="rgba(0,0,0,0)";x.style.borderBottom="1px solid rgba(255, 255, 255, 0)";r=!1;a=n.childNodes.length;for(var b;a--;)b=n.childNodes[a],b.removeEventListener("mousedown",editor.bigDown),n.removeChild(b);editor.Bdefault(p[0])};editor.addButtonBig=function(a){var b=document.createElement("div");b.className="menuButtonBig";n.appendChild(b);b.innerHTML="&bull; "+a.charAt(0).toUpperCase()+a.substring(1).toLowerCase();
b.name=a;b.addEventListener("mousedown",editor.bigDown,!1)};editor.bigDown=function(a){editor.hideBigMenu();editor.load("demos/"+a.target.name+".js")};editor.Bover=function(a){a.target.style.border="1px solid #308AFF";a.target.style.background="#308AFF";a.target.style.color="#c2d0ff"};editor.Bout=function(a){var b=0;"code"==a.target.name&&C&&(b=1);"demo"==a.target.name&&r&&(b=1);b?(a.target.style.border="1px solid #5c5c5c",a.target.style.background="#5c5c5c",a.target.style.color="#999999"):editor.Bdefault(a.target)};
editor.Bdefault=function(a){a.style.border="1px solid #5c5c5c";a.style.background="#242424";a.style.color="#dedede"};editor.Gover=function(){v.setAttribute("fill","#105AE2");D.style.webkitAnimationName="octocat-wave";D.style.webkitAnimationDuration="560ms"};editor.Gout=function(){v.setAttribute("fill","rgba(255,255,255,0.2)");D.style.webkitAnimationName="none"};editor.Gdown=function(){window.location.assign("https://github.com/lo-th/Ammo.lab")};editor.mid_over=function(){f.style.background="#5c5c5c"};
editor.mid_out=function(){s||(f.style.background="none")};editor.mid_down=function(){s=!0;document.addEventListener("mouseup",editor.mid_up,!1);document.addEventListener("mousemove",editor.resize,!1)};editor.mid_up=function(){s=!1;document.removeEventListener("mouseup",editor.mid_up,!1);document.removeEventListener("mousemove",editor.resize,!1)};editor.load=function(a){z=a.substring(a.indexOf("/")+1,a.indexOf("."));var b=new XMLHttpRequest;b.overrideMimeType("text/plain; charset=x-user-defined");
b.open("GET",a,!0);b.onload=function(){e.setValue(b.responseText)};b.send()};editor.unFocus=function(){e.getInputField().blur();view.haveFocus()};editor.refresh=function(){e.refresh()};editor.getFocus=function(){return m};editor.validate=function(a){return e.operation(function(){for(;0<y.length;)e.removeLineClass(y.shift(),"background","errorLine");for(var b=u.length;b--;)e.removeLineWidget(u[b]);u.length=0;try{for(var c=esprima.parse(a,{tolerant:!0}).errors,b=c.length;b--;){var d=c[b],f=document.createElement("div");
f.className="esprima-error";f.textContent=d.message.replace(/Line [0-9]+: /,"");var k=d.lineNumber-1;y.push(k);e.addLineClass(k,"background","errorLine");var g=e.addLineWidget(k,f);u.push(g)}}catch(h){f=document.createElement("div"),f.className="esprima-error",f.textContent=h.message.replace(/Line [0-9]+: /,""),k=h.lineNumber-1,y.push(k),e.addLineClass(k,"background","errorLine"),g=e.addLineWidget(k,f),u.push(g)}return 0===y.length})};editor.onChange=function(){clearTimeout(F);var a=e.getValue();
this.validate(a)&&(F=setTimeout(function(){editor.inject(a)},500))};editor.inject=function(a){var b=document.createElement("script");b.language="javascript";b.type="text/javascript";b.text=a;document.getElementsByTagName("BODY").item(0).appendChild(b);d.innerHTML="&bull; "+z;g.innerHTML=z.charAt(0).toUpperCase()+z.substring(1).toLowerCase();k(z)};return editor}();Math.torad=0.017453292519943295;Math.todeg=57.29577951308232;Math.degtorad=0.017453292519943295;Math.radtodeg=57.29577951308232;Math.Pi=3.141592653589793;Math.TwoPI=6.283185307179586;Math.PI90=1.570796326794896;Math.PI270=4.712388980384689;Math.lerp=function(a,c,e){return a+(c-a)*e};Math.rand=function(a,c){return Math.lerp(a,c,Math.random())};Math.randInt=function(a,c,e){return 1*Math.lerp(a,c,Math.random()).toFixed(e||0)};Math.int=function(a){return~~a};
var view=function(){var a=0,c=0,e=0,f=0,d=!0,h,g,k,l,m,y,u,F,w,b,z,x=!1,p=1,n=1,r=0,C,s=[],v=[],D=[],E=[],A=[],H=[],B=[],M={},P=!1,J=null,O,L=0,N=0,G,q,U,K=!1,I,R,Z,W=-0.01,V=null,$,Q=1,S=!0,X="wireframe ceramic plastic smooth metal chrome brush black glow red sky".split(" "),T;return view={init:function(a){h=document.createElement("canvas");h.className="canvas3d";h.oncontextmenu=function(a){a.preventDefault()};h.ondrop=function(a){a.preventDefault()};document.body.appendChild(h);try{g=new THREE.WebGLRenderer({canvas:h,
antialias:!0,alpha:!1})}catch(t){null!==intro&&intro.message("<p>Sorry, your browser does not support WebGL.</p><p>This application uses WebGL to quickly draw AMMO Physics.</p><p>AMMO Physics can be used without WebGL, but unfortunately this application cannot.</p><p>Have a great day!</p>");return}null!==intro&&intro.clear();g.setClearColor(2368548,1);g.setPixelRatio(window.devicePixelRatio);g.gammaInput=!0;g.gammaOutput=!0;g.toneMapping=THREE.Uncharted2ToneMapping;g.toneMappingExposure=3;g.toneMappingWhitePoint=
5;k=new THREE.Scene;F=new THREE.Group;k.add(F);l=new THREE.PerspectiveCamera(60,1,1,1E3);l.position.set(0,0,30);m=new THREE.OrbitControls(l,h);m.target.set(0,0,0);m.enableKeys=!1;m.update();O=new THREE.Group;k.add(O);O.add(l);this.addLights();U=new THREE.TextureLoader;y=new THREE.Raycaster;u=new THREE.Vector2;G={box:new THREE.BoxBufferGeometry(1,1,1),cone:new THREE.CylinderBufferGeometry(0,1,0.5),wheel:new THREE.CylinderBufferGeometry(1,1,1,18),sphere:new THREE.SphereBufferGeometry(1,16,12),cylinder:new THREE.CylinderBufferGeometry(1,
1,1,12,1)};G.wheel.rotateZ(-Math.PI90);q={terrain:new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,name:"terrain",wireframe:!0}),cloth:new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,name:"cloth",wireframe:!0,transparent:!0,opacity:0.9,side:THREE.DoubleSide}),ball:new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors,name:"ball",wireframe:!0}),statique:new THREE.MeshBasicMaterial({color:3355545,name:"statique",wireframe:!0,transparent:!0,opacity:0.6}),move:new THREE.MeshBasicMaterial({color:10066329,
name:"move",wireframe:!0}),movehigh:new THREE.MeshBasicMaterial({color:16751001,name:"movehigh",wireframe:!0}),sleep:new THREE.MeshBasicMaterial({color:10066431,name:"sleep",wireframe:!0}),hero:new THREE.MeshBasicMaterial({color:10040217,name:"hero",wireframe:!0}),cars:new THREE.MeshBasicMaterial({color:16777215,name:"cars",wireframe:!0,transparent:!0,side:THREE.DoubleSide}),tmp1:new THREE.MeshBasicMaterial({color:16777215,name:"tmp1",wireframe:!0,transparent:!0}),tmp2:new THREE.MeshBasicMaterial({color:16777215,
name:"tmp2",wireframe:!0,transparent:!0}),meca1:new THREE.MeshBasicMaterial({color:16777215,name:"meca1",wireframe:!0}),meca2:new THREE.MeshBasicMaterial({color:16777215,name:"meca2",wireframe:!0}),meca3:new THREE.MeshBasicMaterial({color:16777215,name:"meca3",wireframe:!0}),pig:new THREE.MeshBasicMaterial({color:13870992,name:"pig",wireframe:!0,transparent:!1}),avatar:new THREE.MeshBasicMaterial({color:13870992,name:"avatar",wireframe:!0,transparent:!1}),both:new THREE.MeshBasicMaterial({color:16777215,
name:"both",wireframe:!0,side:THREE.DoubleSide}),back:new THREE.MeshBasicMaterial({color:16777215,name:"back",wireframe:!0,side:THREE.BackSide})};C=new THREE.GridHelper(50,20,16777215,3355443);C.material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,transparent:!0,opacity:0.1});k.add(C);window.addEventListener("resize",view.resize,!1);this.resize();this.initEnv();a&&a()},addLights:function(){R=new THREE.DirectionalLight(16777215,1);R.position.set(-3,50,5);R.lookAt(new THREE.Vector3);
k.add(R);Z=new THREE.AmbientLight(4473924);k.add(Z)},resize:function(){n=window.innerHeight;p=window.innerWidth-r;h.style.left=r+"px";l.aspect=p/n;l.updateProjectionMatrix();g.setSize(p,n);editor&&editor.resizeMenu(p)},setLeft:function(a){r=a},getFps:function(){return f},getInfo:function(){return g.info.programs.length},render:function(){a=now();a-1E3>c&&(c=a,f=e,e=0);e++;g.render(k,l)},addMap:function(a,t){var b=U.load("textures/"+a);b.flipY=!1;q[t].map=b},getGeo:function(){return G},getMat:function(){return q},
getScene:function(){return k},removeRay:function(){x&&(x=!1,h.removeEventListener("mousemove",view.rayTest,!1),b=null,F.remove(z),k.remove(w))},activeRay:function(a){x=!0;var t=new THREE.PlaneBufferGeometry(100,100);t.rotateX(-Math.PI90);z=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:0}));F.add(z);w=new THREE.Mesh(G.box,new THREE.MeshBasicMaterial({color:16711680}));k.add(w);h.addEventListener("mousemove",view.rayTest,!1);b=a},rayTest:function(a){u.x=(a.clientX-
r)/p*2-1;u.y=2*-(a.clientY/n)+1;y.setFromCamera(u,l);a=y.intersectObjects(F.children,!0);a.length&&(w.position.copy(a[0].point),b(w))},changeMaterial:function(a){var t,b,c;0===a?(S=!0,b="MeshBasicMaterial",this.removeShadow()):(S=!1,b="MeshStandardMaterial",this.addShadow());for(c in q)t=q[c],a=t.name,q[a]=new THREE[b]({name:a,envMap:null,map:t.map||null,vertexColors:t.vertexColors||!1,color:void 0===t.color?16777215:t.color.getHex(),wireframe:S,transparent:t.transparent||!1,opacity:t.opacity||1,
side:t.side||THREE.FrontSide}),S||(q[a].envMap=T,q[a].metalness=0.6,q[a].roughness=0.4),t.dispose();for(c=s.length;c--;)a=s[c].material.name,s[c].material=q[a];for(c=v.length;c--;)a=v[c].material.name,v[c].material=q[a];for(c=A.length;c--;){if(void 0==A[c].material)for(t=A[c].children.length;t--;)a=A[c].children[t].material.name,"helper"!==a&&(A[c].children[t].material=q[a]);else a=A[c].material.name,A[c].material=q[a];for(t=A[c].userData.w.length;t--;)a=A[c].userData.w[t].material.name,A[c].userData.w[t].material=
q[a]}for(c=D.length;c--;)a=D[c].material.name,D[c].material=q[a];for(c=E.length;c--;)2!==E.softType&&(a=E[c].material.name,E[c].material=q[a])},needFocus:function(){h.addEventListener("mouseover",editor.unFocus,!1)},haveFocus:function(){h.removeEventListener("mouseover",editor.unFocus,!1)},initEnv:function(){var a=document.createElement("div");a.className="env";var t=document.createElement("canvas");t.width=t.height=64;a.appendChild(t);document.body.appendChild(a);$=t.getContext("2d");a.onclick=this.loadEnv;
a.oncontextmenu=this.loadEnv;this.loadEnv()},loadEnv:function(a){var t=0;a&&(a.preventDefault(),t=a.button,0===t?Q++:Q--,Q==X.length&&(Q=0),0>Q&&(Q=X.length-1));var b=new Image;b.onload=function(){$.drawImage(b,0,0,64,64);T=new THREE.Texture(b);T.mapping=THREE.SphericalReflectionMapping;T.format=THREE.RGBFormat;T.needsUpdate=!0;0!==Q||S||view.changeMaterial(0);if(0!==Q)if(S)view.changeMaterial(1);else for(var a in q)q[a].envMap=T};b.src="textures/spherical/"+X[Q]+".jpg"},hideGrid:function(){C.visible=
C.visible?!1:!0},load:function(a,t){var b=new THREE.SEA3D({});b.onComplete=function(a){a=b.geometries.length;for(var Y;a--;)Y=b.geometries[a],G[Y.name]=Y;t&&t()};b.load("models/"+a+".sea")},mergeMesh:function(a){return THREE.ViewUtils.mergeGeometryArray(a)},prepaGeometry:function(a,b){return THREE.ViewUtils.prepaGeometry(a,b)},controlUpdate:function(){if(P&&null!==J){var a=J,b=a.userData.type,c=a.userData.speed;"car"===b&&10>c&&-10<c?view.setControle(!0):"hero"===b&&0===c?(view.setControle(!0),L=
m.getAzimuthalAngle()+Math.Pi,L!==N&&(N=L,ammo.send("heroRotation",{id:a.userData.id,angle:N}))):(view.setControle(!1),c=new THREE.Matrix4,c.extractRotation(a.matrix),b=new THREE.Vector3(0,0,1),b.applyMatrix4(c),a=a.position,b=Math.atan2(b.x,b.z)*Math.radtodeg-180,view.moveCamera(b,20,10,0.3,a))}},setFollow:function(a){J=this.getByName(a);null!==J&&(P=!0)},moveCamera:function(a,b,c,e,d){e=e||1;d&&m.target.set(d.x||0,d.y||0,d.z||0);l.position.lerp(this.orbit(a,b,c),e);m.update()},orbit:function(a,
b,c){var e=new THREE.Vector3;b=(b-90)*Math.torad;a=(a+180)*Math.torad;e.x=c*Math.sin(b)*Math.sin(a);e.y=c*Math.cos(b);e.z=c*Math.sin(b)*Math.cos(a);c=new THREE.Vector3;c.copy(m.target).add(e);return c},setControle:function(a){m.enableRotate!==a&&(m.enableRotate=a,m.enableZoom=a,m.enablePan=a)},resetCamera:function(){view.setControle(!0);J=null},setDriveCar:function(a){ammo.send("setDriveCar",{n:this.getByName(a).userData.id})},toRad:function(a){for(var b=a.length;b--;)a[b]*=Math.torad;return a},reset:function(){view.removeRay();
view.setShadowPosY(-0.01);C.visible=!0;for(var a,b;0<s.length;)k.remove(s.pop());for(;0<v.length;)k.remove(v.pop());for(;0<D.length;)k.remove(D.pop());for(;0<E.length;)k.remove(E.pop());for(;0<H.length;)k.remove(H.pop());for(;0<B.length;)B.pop().dispose();for(;0<A.length;){a=A.pop();a.userData.helper&&(a.remove(a.userData.helper),a.userData.helper.dispose());for(b=a.userData.w.length;b--;)k.remove(a.userData.w[b]);k.remove(a)}s.length=0;V=null;M={};view.resetCamera();d=!0},add:function(a){var b=!1;
a.mass=void 0==a.mass?0:a.mass;a.type=void 0==a.type?"box":a.type;a.pos=void 0==a.pos?[0,0,0]:a.pos;a.size=void 0==a.size?[1,1,1]:a.size;1==a.size.length&&(a.size[1]=a.size[0]);2==a.size.length&&(a.size[2]=a.size[0]);a.geoSize&&(1==a.geoSize.length&&(a.geoSize[1]=a.geoSize[0]),2==a.geoSize.length&&(a.geoSize[2]=a.geoSize[0]));a.rot=void 0==a.rot?[0,0,0]:this.toRad(a.rot);a.quat=(new THREE.Quaternion).setFromEuler((new THREE.Euler).fromArray(a.rot)).toArray();a.rotA&&(a.quatA=(new THREE.Quaternion).setFromEuler((new THREE.Euler).fromArray(this.toRad(a.rotA))).toArray());
a.rotB&&(a.quatB=(new THREE.Quaternion).setFromEuler((new THREE.Euler).fromArray(this.toRad(a.rotB))).toArray());a.angUpper&&(a.angUpper=this.toRad(a.angUpper));a.angLower&&(a.angLower=this.toRad(a.angLower));var c=null;if("joint"===a.type.substring(0,5))ammo.send("add",a);else if("plane"===a.type)C.position.set(a.pos[0],a.pos[1],a.pos[2]),ammo.send("add",a);else if("softTriMesh"===a.type)this.softTriMesh(a);else if("softConvex"===a.type)this.softConvex(a);else if("cloth"===a.type)this.cloth(a);else if("rope"===
a.type)this.rope(a);else if("ellipsoid"===a.type)this.ellipsoid(a);else if("terrain"===a.type)this.terrain(a);else{c=void 0!==a.material?q[a.material]:a.mass?q.move:q.statique;if("capsule"==a.type)b=new THREE.CapsuleBufferGeometry(a.size[0],0.5*a.size[1]),c=new THREE.Mesh(b,c),B.push(c.geometry),b=!0;else if("mesh"==a.type||"convex"==a.type)a.v=view.prepaGeometry(a.shape,a.type),a.geometry?(c=new THREE.Mesh(a.geometry,c),B.push(a.geometry),B.push(a.shape)):(c=new THREE.Mesh(a.shape,c),B.push(c.geometry));
else{if(a.geometry){if(a.geoRot||a.geoScale)a.geometry=a.geometry.clone();a.geoRot&&a.geometry.applyMatrix((new THREE.Matrix4).makeRotationFromEuler((new THREE.Euler).fromArray(this.toRad(a.geoRot))));a.geoScale&&a.geometry.applyMatrix((new THREE.Matrix4).makeScale(a.geoScale[0],a.geoScale[1],a.geoScale[2]))}c=new THREE.Mesh(a.geometry||G[a.type],c);a.geometry&&(B.push(a.geometry),c.scale.fromArray(a.geoSize),b=!0)}c&&(b||c.scale.fromArray(a.size),c.position.fromArray(a.pos),c.quaternion.fromArray(a.quat),
c.receiveShadow=!0,c.castShadow=!0,this.setName(a,c),k.add(c),a.mass?s.push(c):v.push(c));a.shape&&delete a.shape;a.geometry&&delete a.geometry;a.material&&delete a.material;ammo.send("add",a)}},getGeoByName:function(a,b){for(var c,e=G.length;e--;)a==G[e].name&&(c=G[e]);b&&(c=(new THREE.BufferGeometry).fromGeometry(c));return c},character:function(a){a.size=void 0==a.size?[0.5,1,1]:a.size;1==a.size.length&&(a.size[1]=a.size[0]);2==a.size.length&&(a.size[2]=a.size[0]);a.pos=void 0===a.pos?[0,3,0]:
a.pos;a.rot=void 0==a.rot?[0,0,0]:this.toRad(a.rot);a.quat=(new THREE.Quaternion).setFromEuler((new THREE.Euler).fromArray(a.rot)).toArray();var b=new THREE.CapsuleBufferGeometry(a.size[0],0.5*a.size[1]),b=new THREE.Mesh(b,q.hero);B.push(b.geometry);b.position.fromArray(a.pos);b.quaternion.fromArray(a.quat);b.userData.speed=0;b.userData.type="hero";b.userData.id=H.length;b.castShadow=!0;b.receiveShadow=!0;k.add(b);H.push(b);this.setName(a,b);a.mesh&&delete a.mesh;ammo.send("character",a)},vehicle:function(a){var b=
a.size||[2,0.5,4],c=a.pos||[0,0,0],e=a.rot||[0,0,0],d=a.wPos||[1,0,1.6],f=a.massCenter||[0,0.25,0];this.toRad(e);if(a.mesh)for(var b=a.mesh,g=b.children.length;g--;)b.children[g].position.set(f[0],f[1],f[2]),b.children[g].castShadow=!0,b.children[g].receiveShadow=!0;else b=(new THREE.BufferGeometry).fromGeometry(new THREE.BoxGeometry(b[0],b[1],b[2])),b.translate(f[0],f[1],f[2]),B.push(b),b=new THREE.Mesh(b,q.move);b.position.set(c[0],c[1],c[2]);b.rotation.set(e[0],e[1],e[2]);a.quat=b.quaternion.toArray();
b.castShadow=!0;b.receiveShadow=!0;k.add(b);this.setName(a,b);b.userData.speed=0;b.userData.steering=0;b.userData.NumWheels=a.nw||4;b.userData.type="car";a.helper&&(b.userData.helper=new THREE.CarHelper(d),b.add(b.userData.helper));var c=a.radius||0.4,e=a.deep||0.3,d=[],f=void 0==a.wheel?!0:!1,g=a.wheel||G.wheel,h=g.clone();h.rotateY(Math.Pi);B.push(h);for(var l=a.nw||4;l--;)d[l]=1==l||2==l?new THREE.Mesh(g,q.move):new THREE.Mesh(h,q.move),f?d[l].scale.set(e,c,c):d[l].material=q.cars,d[l].castShadow=
!0,d[l].receiveShadow=!0,k.add(d[l]);b.userData.w=d;A.push(b);b.userData.id=A.length-1;a.mesh&&(a.mesh=null);a.wheel&&(a.wheel=null);if("mesh"==a.type||"convex"==a.type)a.v=view.prepaGeometry(a.shape,a.type);a.shape&&delete a.shape;a.mesh&&delete a.mesh;ammo.send("vehicle",a)},softTriMesh:function(a){var b=a.shape.clone(),c=a.pos||[0,0,0],e=a.size||[1,1,1],d=a.rot||[0,0,0];b.translate(c[0],c[1],c[2]);b.scale(e[0],e[1],e[2]);b.applyMatrix((new THREE.Matrix4).makeRotationY(d[1]*=Math.torad));view.prepaGeometry(b);
B.push(b);a.v=b.realVertices;a.i=b.realIndices;a.ntri=b.numFaces;b=new THREE.Mesh(b,void 0===a.material?q.cloth:q[a.material]);b.castShadow=!0;b.receiveShadow=!0;b.softType=5;k.add(b);E.push(b);a.shape&&delete a.shape;a.material&&delete a.material;ammo.send("add",a)},softConvex:function(a){var b=a.shape,c=a.pos||[0,0,0];b.translate(c[0],c[1],c[2]);view.prepaGeometry(b);a.v=b.realVertices;b=new THREE.Mesh(b,q.cloth);b.castShadow=!0;b.receiveShadow=!0;b.softType=4;k.add(b);E.push(b);ammo.send("add",
a)},cloth:function(a){var b=a.div||[16,16],c=a.size||[100,0,100],e=a.pos||[0,0,0],d=b[0]*b[1],f=new THREE.PlaneBufferGeometry(c[0],c[2],b[0]-1,b[1]-1);f.addAttribute("color",new THREE.BufferAttribute(new Float32Array(3*d),3));f.rotateX(-Math.PI90);d=new THREE.Mesh(f,q.cloth);this.setName(a,d);d.position.set(e[0],e[1],e[2]);d.castShadow=!0;d.receiveShadow=!0;d.softType=1;k.add(d);E.push(d);a.size=c;a.div=b;a.pos=e;ammo.send("add",a)},rope:function(a){var b=new THREE.Tubex(a,a.numSegment||10,a.radius||
0.2,6,!1),b=new THREE.Mesh(b,q.ball);this.setName(a,b);b.castShadow=!0;b.receiveShadow=!0;b.softType=2;k.add(b);E.push(b);ammo.send("add",a)},ellipsoid:function(a){ammo.send("add",a)},ellipsoidMesh:function(a){var b=a.lng,c=[],e=a.a,d,f,g,h;for(d=0;d<b;d++)h=3*d,c.push(new THREE.Vector3(e[h],e[h+1],e[h+2]));var c=new THREE.ConvexGeometry(c),l=new Uint32Array(3*c.faces.length),n=new Float32Array(3*b),m=new Float32Array(b);g=c.vertices;for(d=b;d--;)for(f=b;f--;)h=3*f,e[h]==g[d].x&&e[h+1]==g[d].y&&e[h+
2]==g[d].z&&(m[f]=d);for(d=b;d--;)h=3*d,f=3*m[d],n[f]=e[h],n[f+1]=e[h+1],n[f+2]=e[h+2];for(d=c.faces.length;d--;)h=3*d,e=c.faces[d],l[h]=e.a,l[h+1]=e.b,l[h+2]=e.c;d=new THREE.BufferGeometry;d.setIndex(new THREE.BufferAttribute(l,1));d.addAttribute("position",new THREE.BufferAttribute(n,3));d.addAttribute("color",new THREE.BufferAttribute(new Float32Array(3*b),3));d.addAttribute("order",new THREE.BufferAttribute(m,1));d.computeVertexNormals();B.push(d);c.dispose();b=new THREE.Mesh(d,q.ball);this.setName(a,
b);b.softType=3;b.castShadow=!0;b.receiveShadow=!0;k.add(b);E.push(b)},terrain:function(a){var b,c,d,e;a.div=void 0==a.div?[64,64]:a.div;a.size=void 0==a.size?[100,10,100]:a.size;a.pos=void 0==a.pos?[0,0,0]:a.pos;a.dpos=void 0==a.dpos?[0,0,0]:a.dpos;a.complexity=void 0==a.complexity?30:a.complexity;a.lng=a.div[0]*a.div[1];a.hdata=new Float32Array(a.lng);V||(V=new Perlin);var f=1/a.complexity,h=1/a.div[0],g=(a.div[0]-1)/a.size[0],l=(a.div[1]-1)/a.size[2],n=new Float32Array(3*a.lng),m=new THREE.PlaneBufferGeometry(a.size[0],
a.size[2],a.div[0]-1,a.div[1]-1);m.rotateX(-Math.PI90);var p=m.attributes.position.array;for(b=a.lng;b--;)e=3*b,c=b%a.div[0],d=~~(b*h),c=0.5+0.5*V.noise((c+a.dpos[0]*g)*f,(d+a.dpos[2]*l)*f),a.hdata[b]=c*a.size[1],p[e+1]=a.hdata[b],n[e]=c,n[e+1]=c,n[e+2]=c;m.addAttribute("color",new THREE.BufferAttribute(n,3));m.computeBoundingSphere();m.computeVertexNormals();B.push(m);b=new THREE.Mesh(m,q.terrain);b.position.fromArray(a.pos);b.castShadow=!1;b.receiveShadow=!0;this.setName(a,b);k.add(b);D.push(b);
ammo.send("add",a);I&&k.remove(I)},moveTerrain:function(a){},setName:function(a,b){void 0!==a.name&&(M[a.name]=b,b.name=a.name)},getByName:function(a){return M[a]||null},update:function(){this.bodyStep();this.heroStep();this.carsStep();this.softStep();this.controlUpdate();d&&(d=!1)},bodyStep:function(){s.length&&s.forEach(function(a,b){var c=8*b,d=Br[c];if(0<d)"sleep"==a.material.name&&(a.material=q.move),50<d&&"move"==a.material.name?a.material=q.movehigh:50>d&&"movehigh"==a.material.name&&(a.material=
q.move),a.position.fromArray(Br,c+1),a.quaternion.fromArray(Br,c+4);else if("move"==a.material.name||"movehigh"==a.material.name)a.material=q.sleep})},heroStep:function(){H.length&&H.forEach(function(a,b){var c=8*b;a.userData.speed=100*Hr[c];a.position.fromArray(Hr,c+1);a.quaternion.fromArray(Hr,c+4)})},carsStep:function(){A.length&&A.forEach(function(a,b){var c=56*b;a.userData.speed=Cr[c];a.position.fromArray(Cr,c+1);a.quaternion.fromArray(Cr,c+4);var d=a.userData.NumWheels,e;a.userData.helper&&
4==d&&(e=40,a.userData.helper.updateSuspension(Cr[c+e+0],Cr[c+e+1],Cr[c+e+2],Cr[c+e+3]));for(;d--;)e=8*(d+1),a.userData.w[d].position.fromArray(Cr,c+e+1),a.userData.w[d].quaternion.fromArray(Cr,c+e+4)})},getSofts:function(){return E},softStep:function(){if(E.length){var a=0;E.forEach(function(b,c){var d,e,f,h,g,k,l=b.softType,m=null,n=b.geometry.attributes.color?!0:!1,p=b.geometry.attributes.normal?!0:!1;if(2===l){for(g=b.geometry.positions.length;g--;)d=a+3*g,b.geometry.positions[g].set(Sr[d],Sr[d+
1],Sr[d+2]);b.geometry.updatePath();a+=3*b.geometry.positions.length}else{h=b.geometry.attributes.position.array;n&&(e=b.geometry.attributes.color.array);if(5===l||4===l){var q=b.geometry.numVertices,r=b.geometry.maxi,s=b.geometry.pPoint,u=b.geometry.lPoint;for(g=q;g--;)for(d=3*g+a,k=g==q-1?r-s[g]:s[g+1]-s[g],f=s[g];k--;)e=3*u[f+k],h[e]=Sr[d],h[e+1]=Sr[d+1],h[e+2]=Sr[d+2]}else if(b.geometry.attributes.order&&(m=b.geometry.attributes.order.array),g=h.length,d=2,null!==m)for(g=m.length;g--;)k=3*m[g],
d=3*g+a,h[k]=Sr[d],h[k+1]=Sr[d+1],h[k+2]=Sr[d+2],f=Math.abs(Sr[d+1]/10),e[k]=f,e[k+1]=f,e[k+2]=f;else for(;g--;)h[g]=Sr[g+a],1==d&&(f=Math.abs(h[g]/10),e[g-1]=f,e[g]=f,e[g+1]=f),d--,d=0>d?2:d;2!==l&&b.geometry.computeVertexNormals();b.geometry.attributes.position.needsUpdate=!0;if(p){d=b.geometry.attributes.normal.array;for(g=q;g--;)for(k=g==q-1?r-s[g]:s[g+1]-s[g],f=s[g],p=3*u[f];k--;)e=3*u[f+k],d[e]=d[p],d[e+1]=d[p+1],d[e+2]=d[p+2];b.geometry.attributes.normal.needsUpdate=!0}n&&(b.geometry.attributes.color.needsUpdate=
!0);b.geometry.computeBoundingSphere();a=5===l?a+3*b.geometry.numVertices:a+h.length}})}},removeShadow:function(){K&&(K=!1,g.shadowMap.enabled=!1,I&&k.remove(I))},setShadowPosY:function(a){W=a;I&&(I.position.y=W)},addShadow:function(){if(!K){K=!0;g.shadowMap.enabled=!0;g.shadowMap.soft=!0;g.shadowMap.type=THREE.PCFSoftShadowMap;g.shadowMap.renderReverseSided=!1;if(!D.length){var a=new THREE.ShaderMaterial(THREE.ShaderShadow);I=new THREE.Mesh(new THREE.PlaneBufferGeometry(200,200,1,1),a);I.geometry.applyMatrix((new THREE.Matrix4).makeRotationX(0.5*
-Math.PI));I.position.y=W;I.castShadow=!1;I.receiveShadow=!0;k.add(I)}R.castShadow=!0;a=new THREE.OrthographicCamera(70,-70,70,-70,25,170);R.shadow=new THREE.LightShadow(a);R.shadow.mapSize.width=1024;R.shadow.mapSize.height=1024}}}}();
